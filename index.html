<!DOCTYPE html>
<html>
<head>
    <title>Python Code Collapser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .method-container, .constant-container {
            margin: 5px 0;
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: #f8f8f8;
            display: flex;
            align-items: center;
            border-radius: 4px;
        }
        .async-method {
            border-left: 4px solid #4CAF50;
        }
        .constant-container {
            border-left: 4px solid #9c27b0;
        }
        textarea {
            width: 100%;
            height: 300px;
            margin: 10px 0;
            font-family: monospace;
            padding: 10px;
        }
        .output-code {
            white-space: pre;
            font-family: monospace;
            background-color: #f8f8f8;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-x: auto;
        }
        .method-name, .constant-name {
            font-family: monospace;
            margin-left: 8px;
        }
        .async-badge, .constant-badge {
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-left: 8px;
        }
        .async-badge {
            background-color: #4CAF50;
        }
        .constant-badge {
            background-color: #9c27b0;
        }
        .control-panel {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .class-section, .constant-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .class-name, .section-header {
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .error {
            color: #dc3545;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #dc3545;
            border-radius: 4px;
            background-color: #f8d7da;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/python-ast/0.0.30/ast.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.0/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.0/mode-python.js"></script>
</head>
<body>
    <h1>Python Code Collapser</h1>
    
    <div>
        <h3>Input Python Code:</h3>
        <textarea id="codeInput" placeholder="Paste your Python code here..."></textarea>
    </div>

    <div class="control-panel">
        <button onclick="analyzeCode()">Analyze Code</button>
        <button onclick="generateCollapsedCode()">Generate Modified Code</button>
        <button onclick="selectAll()">Select All</button>
        <button onclick="deselectAll()">Deselect All</button>
    </div>

    <div id="error" style="display: none;" class="error"></div>
    <div id="constantsList"></div>
    <div id="methodsList"></div>
    <h3>Output Code:</h3>
    <div id="output" class="output-code"></div>

    <script>
class CodeAnalyzer {
    constructor(code) {
        this.code = code;
    }

    analyze() {
        const classes = [];
        const constants = [];
        
        // Split code into lines
        const lines = this.code.split('\n');
        
        let currentClass = null;
        let currentMethods = [];
        
        // Process each line
        lines.forEach((line, index) => {
            // Check for class definitions
            const classMatch = line.match(/class\s+(\w+)/);
            if (classMatch) {
                if (currentClass) {
                    classes.push({
                        name: currentClass,
                        methods: currentMethods
                    });
                }
                currentClass = classMatch[1];
                currentMethods = [];
            }
            
            // Check for method definitions
            const methodMatch = line.match(/(async\s+)?def\s+(\w+)\s*\((.*?)\)/);
            if (methodMatch && currentClass) {
                currentMethods.push({
                    name: methodMatch[2],
                    signature: `${methodMatch[1] || ''}def ${methodMatch[2]}(${methodMatch[3]})`,
                    is_async: !!methodMatch[1]
                });
            }
            
            // Check for constants
            const constantMatch = line.match(/^([A-Z_][A-Z0-9_]*)\s*=/);
            if (constantMatch && !currentClass) {
                constants.push({
                    name: constantMatch[1],
                    value: line.split('=')[1].trim()
                });
            }
        });
        
        // Add the last class if exists
        if (currentClass) {
            classes.push({
                name: currentClass,
                methods: currentMethods
            });
        }
        
        return { classes, constants };
    }

    collapseCode(methodsToCollapse, constantsToCollapse) {
        const lines = this.code.split('\n');
        let inMethodToCollapse = false;
        let indentationLevel = 0;
        
        return lines.map((line, index) => {
            // Check if this line starts a method to collapse
            const methodMatch = line.match(/(async\s+)?def\s+(\w+)/);
            if (methodMatch) {
                const methodName = methodMatch[2];
                if (methodsToCollapse.some(m => m.method_name === methodName)) {
                    inMethodToCollapse = true;
                    indentationLevel = (line.match(/^\s*/) || [''])[0].length;
                    return line + '\n' + ' '.repeat(indentationLevel + 4) + '# code collapsed';
                }
                inMethodToCollapse = false;
            }
            
            // Skip method body if we're in a method to collapse
            if (inMethodToCollapse) {
                const currentIndent = (line.match(/^\s*/) || [''])[0].length;
                if (currentIndent > indentationLevel) {
                    return null; // Skip this line
                }
                inMethodToCollapse = false;
            }
            
            // Check for constants to collapse
            for (const constant of constantsToCollapse) {
                const constRegex = new RegExp(`^(\\s*${constant}\\s*=\\s*).*`);
                if (constRegex.test(line)) {
                    return line.replace(/=.+$/, '= " code collapsed "');
                }
            }
            
            return line;
        }).filter(line => line !== null).join('\n');
    }
}

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function analyzeCode() {
            hideError();
            const code = document.getElementById('codeInput').value;
            try {
                const analyzer = new CodeAnalyzer(code);
                const result = analyzer.analyze();
                displayConstants(result.constants);
                displayMethods(result.classes);
            } catch (error) {
                showError(error.message);
            }
        }

        function displayConstants(constants) {
            const constantsList = document.getElementById('constantsList');
            if (constants && constants.length > 0) {
                constantsList.innerHTML = '<div class="constant-section"><h4 class="section-header">Constants:</h4>';
                constants.forEach(constant => {
                    const constantDiv = document.createElement('div');
                    constantDiv.className = 'constant-container';
                    constantDiv.innerHTML = `
                        <input type="checkbox" id="constant_${constant.name}" 
                               data-type="constant"
                               data-name="${constant.name}">
                        <span class="constant-name">${constant.name}</span>
                        <span class="constant-badge">CONSTANT</span>
                    `;
                    constantsList.appendChild(constantDiv);
                });
                constantsList.innerHTML += '</div>';
            } else {
                constantsList.innerHTML = '';
            }
        }

        function displayMethods(classes) {
            const methodsList = document.getElementById('methodsList');
            methodsList.innerHTML = '<h3>Select methods to collapse:</h3>';
            
            classes.forEach(cls => {
                const classDiv = document.createElement('div');
                classDiv.className = 'class-section';
                classDiv.innerHTML = `<h4 class="class-name">Class: ${cls.name}</h4>`;
                
                cls.methods.forEach(method => {
                    const methodDiv = document.createElement('div');
                    methodDiv.className = `method-container ${method.is_async ? 'async-method' : ''}`;
                    methodDiv.innerHTML = `
                        <input type="checkbox" id="${cls.name}_${method.name}" 
                               data-type="method"
                               data-class="${cls.name}" 
                               data-method="${method.name}">
                        <span class="method-name">${method.signature}</span>
                        ${method.is_async ? '<span class="async-badge">async</span>' : ''}
                    `;
                    classDiv.appendChild(methodDiv);
                });
                
                methodsList.appendChild(classDiv);
            });
        }

        function generateCollapsedCode() {
            hideError();
            const code = document.getElementById('codeInput').value;
            const selectedItems = {
                methods: [],
                constants: []
            };
            
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                if (checkbox.dataset.type === 'method') {
                    selectedItems.methods.push({
                        class_name: checkbox.dataset.class,
                        method_name: checkbox.dataset.method
                    });
                } else if (checkbox.dataset.type === 'constant') {
                    selectedItems.constants.push(checkbox.dataset.name);
                }
            });
            
            try {
                const analyzer = new CodeAnalyzer(code);
                const modifiedCode = analyzer.collapseCode(selectedItems.methods, selectedItems.constants);
                document.getElementById('output').textContent = modifiedCode;
            } catch (error) {
                showError(error.message);
            }
        }

        function selectAll() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAll() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }
    </script>
</body>
</html>